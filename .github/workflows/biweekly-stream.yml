name: Biweekly 12h YouTube Stream

on:
  schedule:
    # Week 2 Wednesday 11:00 IST (05:30 UTC)
    - cron: '30 5 8-14 * 3'
    # Week 4 Wednesday 11:00 IST (05:30 UTC)
    - cron: '30 5 22-28 * 3'
  workflow_dispatch:

jobs:
  stream:
    runs-on: ubuntu-latest
    timeout-minutes: 720

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install FFmpeg
        run: sudo apt-get update && sudo apt-get install -y ffmpeg

      - name: Select video
        run: |
          DAY=$(date -u +%d)
          if [ "$DAY" -ge 8 ] && [ "$DAY" -le 14 ]; then
            echo "VIDEO=week4.mp4" >> $GITHUB_ENV
          else
            echo "VIDEO=week4.mp4" >> $GITHUB_ENV
          fi

      - name: Stream to YouTube
        run: |
          ffmpeg -re -stream_loop -1 -i "$VIDEO" \
          -c:v libx264 -preset veryfast -pix_fmt yuv420p \
          -c:a aac -b:a 128k -ar 44100 \
          -f flv "rtmp://a.rtmp.youtube.com/live2/${{ secrets.TEST_KEY }}"
